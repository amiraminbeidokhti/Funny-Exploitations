#include <ctype.h>
#include <stdlib.h>
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <unistd.h>

static const char * input_filename = "./input.txt";
static FILE * file;
static char * p;

void check_filelen();

int main(int argc, char * argv[])
{
	char buffer[256];

	check_filelen();

	file = fopen(input_filename, "r");
	p = &buffer[0];
	while (1)
	{
		fread(p, sizeof(char), 1, file);
		if (feof(file)) break;
		if (isprint(*p)) fprintf(stderr, "%c", *p);
		p++;
		fflush(stderr);
		usleep(50000); // pause for 0.05 seconds before printing next char
		               // to mimic a human typing
	}
//	fclose(file);

	//log_message(buffer); //TODO

	return 0;
}

void check_filelen()
{
	struct stat st;
	size_t size;

	stat(input_filename, &st);
	if (st.st_size > 255)
	{
		printf("Try a smaller file.\n");
		exit(1);
	}
}
